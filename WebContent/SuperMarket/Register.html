<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>注册/Register</title>
		<link rel="stylesheet" href="../js/bootstrap-3.3.7-dist/css/bootstrap.css" />
		<script src="../js/jquery-1.11.1/jquery.js"></script>
		<script src="../js/bootstrap-3.3.7-dist/js/bootstrap.js"></script>
	</head>
	<body>
		<div class="alert alert-warning alert-dismissable hide" role="alert" style="position: absolute;right: 0;">
	       <button type="button" class="close" data-dismiss="alert" aria-label="Close">          
	          <span aria-hidden="true">&times;</span>
	       </button>
	       <strong id="alerttext"> </strong>
	   </div>
	   <div class="alert alert-success alert-dismissable hide" role="alert" style="position: absolute;right: 0;">
	       <button type="button" class="close" data-dismiss="alert" aria-label="Close">          
	          <span aria-hidden="true">&times;</span>
	       </button>
	       <strong id="alerttextsucc"> </strong>
	   </div>
	   <div class="alert alert-danger alert-dismissable hide" role="alert" style="position: absolute;right: 0;">
	       <button type="button" class="close" data-dismiss="alert" aria-label="Close">          
	          <span aria-hidden="true">&times;</span>
	       </button>
	       <strong id="alerttextfail"> </strong>
	   </div>
		<div class="col-lg-2"></div>
		<div class="col-lg-4">
			<form method="post" action="Register" name = "Regist_form">
			  <div class="form-group">
			    <label for="exampleInputEmail1">员工编号</label>
			    <input type="text" class="form-control" name="staffid" id="inputId" autocomplete="off" placeholder="staffid" required="required" onblur="loadCheck()" title="Warning"
					data-container="body" data-toggle="popover" data-placement="right"
					data-content="存在重复员工编号，不允许注册">
			  </div>
			  <div class="form-group">
			    <label for="exampleInputEmail1">员工姓名</label>
			    <input type="text" class="form-control" name="staffname" autocomplete="off" placeholder="staffname" required="required">
			  </div>
			  <div class="form-group">
			    <label for="exampleInputPassword1">登录密码</label>
			    <input type="password" class="form-control" name="password" placeholder="Password" required="required">
			  </div>
			  <div class="form-group">
			    <label for="exampleInputEmail1">员工薪资</label>
			    <input type="text" class="form-control" name="salary" placeholder="salary" required="required">
			  </div>
			  <div class="form-group">
			    <label for="exampleInputEmail1">入职时间</label>
			    <input type="date" id="datetimepicker" class="form-control" name="createtime" placeholder="createtime" required="required">
			  </div>
			  <div class="form-group">
				<select name="type" style="height: 34px;width: 136px;padding-top: 6px;padding-bottom: 6px;font-size: 14px;margin-top: 2px;border-radius: 1px;">
				  <option value="0">请选择员工类型</option>
				  <option value="1">超级管理员</option>
				  <option value="2">仓库管理员</option>
				  <option value="3">收银员</option>
				  <option value="4">售货员</option>
				</select>
				<select name="dataflag"  style="height: 34px;width: 136px;padding-top: 6px;padding-bottom: 6px;font-size: 14px;margin-top: 2px;border-radius: 1px;">
					<option value="2">请设置帐号状态</option>
					<option value="1">可用</option>
					<option value="0">禁用</option>
				</select>
			  </div>
			  <input type="button" id="submit_btn" class="btn btn-primary" value="创建账号" onclick="doRegister()">
			</form>
			<script type="text/javascript">
				var xmlhttp;
				function loadCheck(){
					var staffId = document.Regist_form.staffid.value;
					if(staffId.length <= 0){
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else{
						document.getElementById("submit_btn").className="btn btn-primary"
						if (window.XMLHttpRequest) {xmlhttp=new XMLHttpRequest();}
						else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}	
						xmlhttp.open("POST","../checkIdAvailable",true);
						xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
						xmlhttp.send("staffId="+staffId);
						xmlhttp.onreadystatechange=getResult;
					}
					
				}
				
				function getResult(){
					if (xmlhttp.readyState==4) {		
						if(xmlhttp.status==200){
							var rec=xmlhttp.responseText;
							if(rec == "false"){
								$('#inputId').popover('show');
								document.getElementById("submit_btn").className="btn btn-primary disabled"
								
							}
							else{
								$('#inputId').popover('hide');
								document.getElementById("submit_btn").className="btn btn-primary"
							}
						}
						else{
							alert("连接失败");
						}
					}
				}
				
				function doRegister() {
					var staffId = document.Regist_form.staffid.value;
					var staffname = document.Regist_form.staffname.value;
					var password = document.Regist_form.password.value;
					var salary = document.Regist_form.salary.value;
					var createtime = document.Regist_form.createtime.value;
					var type = document.Regist_form.type.value;
					var dataflag = document.Regist_form.dataflag.value;
					if(staffId.length <= 0){
						document.getElementById("alerttext").innerHTML="员工编号为空";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else if(staffname.length <= 0){
						document.getElementById("alerttext").innerHTML="用户名为空";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else if(password.length <= 0){
						document.getElementById("alerttext").innerHTML="密码为空";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else if(salary.length <= 0){
						document.getElementById("alerttext").innerHTML="员工薪资为空";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else if(createtime.length <= 0){
						document.getElementById("alerttext").innerHTML="入职时间为空";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else if(type == 0){
						document.getElementById("alerttext").innerHTML="员工岗位未设置";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else if(dataflag == 2){
						document.getElementById("alerttext").innerHTML="帐号状态未设置";
						$('.alert-warning').removeClass('hide').addClass('in');
						document.getElementById("submit_btn").className="btn btn-primary disabled"
					}
					else {
						document.getElementById("submit_btn").className="btn btn-primary"
						if (window.XMLHttpRequest) {xmlhttp=new XMLHttpRequest();}
						else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");}	
						xmlhttp.open("POST","../Register",true);
						xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
						xmlhttp.send("staffid="+staffId+"&staffname="+staffname+"&password="+password+"&salary="+salary+"&createtime="+createtime+"&type="+type+"&dataflag="+dataflag);
						xmlhttp.onreadystatechange=getRegisterResult;
					}
				}
				
				function getRegisterResult(){
					if (xmlhttp.readyState==4) {		
						if(xmlhttp.status==200){
							var rec=xmlhttp.responseText;
							if(rec == 1){
								document.getElementById("alerttextsucc").innerHTML="帐号注册成功！";
								$('.alert').removeClass('hide').addClass('in');
								
							}
							else if(rec == 2){
								document.getElementById("alerttextfail").innerHTML="帐号注册失败！";
								$('.alert').removeClass('hide').addClass('in');
							}
						}
						else{
							alert("连接失败");
						}
					}
				}
			</script>
		</div>
	</body>
</html>
